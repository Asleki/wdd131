<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Tickets</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* === Consolidated CSS from standalone_header.css, watch.css, shows_movies_list.css, tvshows.css === */

        /* Root Theme Variables (from standalone_header.css & main_styles.css combined) */
        :root {
            --bg: #fff;
            --text: #111;
            --header-bg: #f0ecec;
            --search-bg: #f4f4f4;
            --highlight: rgb(28, 12, 241); /* This is the blue used for highlight */
            --danger: #f44336;
            --cinewatch-blue: #000080; /* Dark blue color for CineWatch name */

            /* Variables for custom message box & dropdown in light mode */
            --message-box-bg: #fff;
            --message-box-text: #111;
            --message-box-border: #ccc;
            --message-box-button-bg: #007bff;
            --message-box-button-text: white;
            --message-box-button-hover-bg: #0056b3;

            --dropdown-bg: #fff;
            --dropdown-item-hover-bg: #f0f0f0;
            --dropdown-border: #ddd;

            /* Light Mode Palette: Fresh Blues (from updated main_styles.css) */
            --primary-color: #0056b3; /* A vibrant blue for main accents and headings */
            --secondary-color: #007bff; /* A slightly lighter blue for links and secondary actions */
            --accent-color: #f39c12; /* Orange for highlights and call-to-action elements */
            --text-color-light: #2C3E50; /* Dark, almost black blue-gray for readability */
            --background-color-light: #F0F8FF; /* Alice Blue - very light, airy blue */
            --section-bg-light: #E6F7FF; /* Pale blue for section backgrounds */
            --border-color-light: #A0D9EF; /* Medium blue for borders */
            --shadow-color-light: rgba(70, 130, 180, 0.2); /* Steel blue with transparency for subtle shadow */
            --header-bg-light: #C9EEFF; /* Light Cyan-like blue for headers */
        }

        body.dark-mode {
            --bg: #111;
            --text: #f4f4f4;
            --header-bg: #8d8181;
            --search-bg: #0a06ff;
            --cinewatch-blue: #2d05f8; /* Lighter blue for dark mode contrast */

            /* Variables for custom message box & dropdown in dark mode */
            --message-box-bg: #2a2a2a;
            --message-box-text: #f4f4f4;
            --message-box-border: #444;
            --message-box-button-bg: #6200ea;
            --message-box-button-text: white;
            --message-box-button-hover-bg: #3700b3;

            --dropdown-bg: #2a2a2a;
            --dropdown-item-hover-bg: #3a3a3a;
            --dropdown-border: #555;

            /* Dark Mode Palette: Existing Grays/Blacks (from updated main_styles.css) */
            --text-color-dark: #f0f0f0; /* Light text on dark backgrounds */
            --background-color-dark: #1a1a1a; /* Dark page background */
            --section-bg-dark: #2a2a2a; /* Dark section background */
            --border-color-dark: #4a4a4a; /* Dark border color */
            --shadow-color-dark: rgba(0, 0, 0, 0.4);
            --header-bg-dark: #464343;
        }

        /* General Reset (from standalone_header.css and watch.css/main_styles.css) */
        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: #1a1a2e; /* Original background for buy_ticket */
            color: #e0e0e0; /* Original text color for buy_ticket */
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            line-height: 1.6;
        }

        body.dark-mode { /* Ensure dark mode theme applies, overriding specific buy_ticket body if needed */
            color: var(--text-color-dark);
            background-color: var(--background-color-dark);
        }

        /* --- Utility Header Styles --- */
        .utility-header {
            background-color: var(--header-bg-light);
            color: var(--text-color-light);
            padding: 8px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            flex-wrap: wrap;
            gap: 10px;
        }

        body.dark-mode .utility-header {
            background-color: var(--header-bg-dark);
            color: var(--text-color-dark);
        }
        body.dark-mode .utility-header .header-action img {
            filter: invert(1);
        }
        body.dark-mode .utility-header .join-cinewatch {
            color: #8ab4f8;
        }
        body.dark-mode .utility-header .join-cinewatch:hover {
            color: #a7c7ff;
        }

        .utility-left, .utility-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .mode-toggle {
            display: flex;
            cursor: pointer;
            font-size: 1.2rem;
            color: inherit;
        }
        .mode-icon {
            width: 22px;
            height: 22px;
            vertical-align: middle;
            display: block;
        }
        .mode-icon.active {
            display: block;
        }
        .light-mode-icon, .dark-mode-icon {
            transition: transform 0.3s ease;
        }
        .light-mode-icon:hover, .dark-mode-icon:hover {
            transform: scale(1.1);
        }
        body.dark-mode .dark-mode-icon {
            filter: invert(1);
        }
        body.dark-mode .light-mode-icon {
            filter: invert(0);
        }

        .header-action {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: inherit;
            transition: opacity 0.2s ease;
        }

        .header-action:hover {
            opacity: 0.7;
        }

        .header-action img {
            width: 22px;
            height: 22px;
            vertical-align: middle;
        }

        .join-cinewatch {
            background-color: var(--primary-color);
            color: white;
            padding: 5px 12px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        .join-cinewatch:hover {
            background-color: var(--secondary-color);
        }

        /* Main Header */
        #mainHeader {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--header-bg);
            color: var(--text);
            padding: 10px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        /* Stylish CineWatch Logo/Site Name */
        .logo a {
            font-family: 'Georgia', serif;
            font-size: 2.4rem;
            font-weight: bold;
            color: var(--cinewatch-blue);
            text-decoration: none;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);
            transition: color 0.3s ease, transform 0.2s ease;
            display: inline-block;
        }

        .logo a:hover {
            color: var(--highlight);
            transform: scale(1.03);
        }

        .nav-icons {
            display: flex;
            align-items: center;
            position: relative; /* For the account dropdown positioning */
        }

        .nav-icons i {
            margin-left: 15px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: color 0.3s, transform 0.3s;
        }

        .yellow-icon {
            color: var(--highlight);
        }

        .red-icon {
            color: var(--danger);
        }

        .nav-icons i:hover {
            transform: scale(1.2);
        }

        /* Specific rule for Search Icon in dark mode */
        body.dark-mode #searchIcon {
            color: var(--highlight);
        }

        /* Search Subheader */
        #searchSubheader {
            background-color: var(--search-bg);
            padding: 10px 20px;
            display: none;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            box-sizing: border-box;
            position: relative;
            z-index: 999;
        }

        #searchSubheader:not(.hidden) {
            display: flex;
            animation: slideDown 0.3s ease-in-out;
        }

        .hidden {
            display: none !important;
        }

        .search-bar-container {
            display: flex;
            align-items: center;
            position: relative;
        }

        #searchInput {
            flex-grow: 1;
            padding: 10px;
            font-size: 1rem;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 6px;
            outline: none;
        }

        .voice-icon, .clear-icon {
            position: absolute;
            right: 35px;
            font-size: 1rem;
            color: var(--text);
            cursor: pointer;
        }

        .clear-icon {
            right: 10px;
        }

        .suggestions-box {
            background: var(--bg);
            border: 1px solid var(--dropdown-border);
            border-radius: 6px;
            max-height: 250px;
            overflow-y: auto;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .suggestions-box div {
            padding: 10px;
            border-bottom: 1px solid var(--dropdown-border);
            cursor: pointer;
            color: var(--text);
        }

        .suggestions-box div:last-child {
            border-bottom: none;
        }

        .suggestions-box div:hover {
            background-color: #eee;
        }

        body.dark-mode .suggestions-box div:hover {
            background-color: #555;
        }

        /* --- Custom Alert/Message Box --- */
        #customAlert {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        #customAlert.show {
            opacity: 1;
            visibility: visible;
        }

        .alert-content {
            background: var(--message-box-bg);
            color: var(--message-box-text);
            padding: 25px 30px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            text-align: center;
            max-width: 90%;
            width: 350px;
            font-family: 'Inter', sans-serif;
            border: 1px solid var(--message-box-border);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            animation: zoomIn 0.3s ease-out;
        }

        .alert-icon {
            font-size: 3em;
            color: var(--highlight);
        }
        .alert-icon.red-icon {
            color: var(--danger);
        }
        .alert-icon.blue-icon {
            color: var(--secondary-color);
        }
        .alert-icon.green-icon {
            color: #28a745;
        }

        .alert-content p {
            margin: 0;
            font-size: 1.1em;
            font-weight: 500;
        }

        .close-alert-btn {
            background-color: var(--message-box-button-bg);
            color: var(--message-box-button-text);
            border: none;
            padding: 10px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        .close-alert-btn:hover {
            background-color: var(--message-box-button-hover-bg);
            transform: translateY(-1px);
        }

        /* --- Account Dropdown Menu Styles --- */
        .account-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--dropdown-bg);
            border: 1px solid var(--dropdown-border);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            min-width: 180px;
            z-index: 1050;
            display: none;
            flex-direction: column;
            overflow: hidden;
            animation: fadeIn 0.2s ease-out;
        }

        .account-dropdown.visible {
            display: flex;
        }

        .account-dropdown a {
            padding: 12px 15px;
            text-decoration: none;
            color: var(--text);
            font-size: 0.95em;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background-color 0.2s ease;
        }

        .account-dropdown a:hover {
            background-color: var(--dropdown-item-hover-bg);
        }

        .account-dropdown a i {
            font-size: 1em;
            margin-left: 0;
            color: var(--text);
        }

        .account-dropdown a.logout-item {
            border-top: 1px solid var(--dropdown-border);
            margin-top: 5px;
            padding-top: 15px;
            color: var(--danger);
            font-weight: bold;
        }
        .account-dropdown a.logout-item:hover {
            background-color: rgba(var(--danger-rgb), 0.1);
        }
        body.dark-mode .account-dropdown a.logout-item {
            color: var(--danger);
        }

        /* Styling for disabled/info links in dropdown */
        .account-dropdown a.disabled-link {
            color: #888;
            cursor: default;
            pointer-events: auto;
            background-color: transparent;
        }
        .account-dropdown a.disabled-link:hover {
            background-color: transparent;
        }

        /* General Body and Layout */
        /* Hero section specific to buy_ticket page */
        #buyTicketHero {
            width: 100%;
            height: 300px;
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            transition: background-image 0.5s ease-in-out;
        }

        #buyTicketHero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(26, 26, 46, 1) 0%, rgba(26, 26, 46, 0.6) 50%, rgba(26, 26, 46, 0.2) 100%);
            z-index: 1;
        }

        #buyTicketHero h1 {
            position: relative;
            z-index: 2;
            color: #e0e0e0;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
            text-align: center;
            padding: 0 1rem;
        }

        /* Main content padding for spacing */
        .main-content-padding {
            padding: 1.5rem;
            max-width: 900px;
            margin: 0 auto;
            width: 100%; /* Ensure it takes full width within max-width */
        }

        /* Stepper styles */
        .stepper-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            position: relative;
            padding: 1rem 0;
        }

        .stepper-line {
            position: absolute;
            height: 3px;
            background-color: #e94560;
            left: 5%;
            right: 5%;
            top: 50%;
            transform: translateY(-50%);
            z-index: 0;
            border-radius: 5px;
        }

        .stepper-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 1;
            flex: 1;
        }

        .step-circle {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: #33334c;
            color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 600;
            border: 2px solid #e94560;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .stepper-item.active .step-circle {
            background-color: #e94560;
            color: #1a1a2e;
            border-color: #ff6a80;
        }
        
        /* Stepper Completion Indicator */
        .stepper-item.completed .step-circle {
            background-color: #28a745; /* Green for completed */
            border-color: #28a745;
            color: #fff;
            position: relative;
        }

        .stepper-item.completed .step-circle::after {
            content: "\f00c"; /* Font Awesome checkmark icon */
            font-family: "Font Awesome 6 Free";
            font-weight: 900; /* Solid icon weight */
            color: #fff;
            position: absolute;
            font-size: 1.2rem;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .stepper-item.completed .step-circle span {
            display: none; /* Hide number when checkmark is shown */
        }


        .step-label {
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: #c0c0c0;
            text-align: center;
        }

        /* Step content sections */
        .step-content {
            background-color: #0f3460;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            margin-bottom: 2rem;
        }

        .step-content.hidden {
            display: none;
        }

        /* Movie details specific styles */
        #movie-details {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        #movie-details img {
            max-width: 250px;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        #movie-details h2 {
            font-size: 2rem;
            font-weight: 700;
            color: #e94560;
            margin-bottom: 0.5rem;
        }

        #movie-details p {
            font-size: 1rem;
            color: #e0e0e0;
            margin-bottom: 0.3rem;
        }

        #movie-details .imdb-rating {
            font-weight: 500;
            color: #ffc107;
        }

        /* Seat selection grid */
        .seats-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr); /* 10 seats per row */
            gap: 5px;
            margin-top: 1rem;
            max-width: 500px; /* Constrain grid width */
            margin-left: auto;
            margin-right: auto;
            overflow-x: auto; /* Allow scrolling for small screens */
            padding-bottom: 10px; /* Space for scrollbar */
        }

        .seat {
            width: 30px;
            height: 30px;
            background-color: #ccc;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            color: #333;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        
        /* Seat Colors */
        .seat.available {
            background-color: #28a745; /* Green for available seats */
            color: #fff;
        }

        .seat.selected {
            background-color: #e94560; /* Your existing red/pink for selected */
            color: #fff;
        }

        .seat.occupied {
            background-color: #555; /* Grey for occupied */
            cursor: not-allowed;
            color: #aaa;
        }

        .screen-indicator {
            width: 80%;
            height: 20px;
            background-color: #555;
            margin: 1rem auto;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem;
            color: #e0e0e0;
            font-weight: 500;
        }

        /* Seat Legend */
        .seat-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
            padding-top: 10px; /* Added padding */
            border-top: 1px solid rgba(255, 255, 255, 0.1); /* Separator */
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: #e0e0e0;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }


        /* Buttons */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .proceed-btn, .back-btn {
            background-color: #e94560;
            color: #1a1a2e;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .proceed-btn:hover, .back-btn:hover {
            background-color: #ff6a80;
            transform: translateY(-2px);
        }

        .back-btn {
            background-color: #555;
        }

        .back-btn:hover {
            background-color: #777;
        }

        /* Summary styles */
        #summary-details p {
            margin-bottom: 0.5rem;
        }

        #summary-details p span {
            font-weight: 600;
            color: #e94560;
        }

        /* Cab Service Options */
        .cab-options input[type="radio"] {
            margin-right: 0.5rem;
            accent-color: #e94560; /* Style radio buttons */
        }

        .cab-option {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .cab-option label {
            font-size: 1rem;
            color: #e0e0e0;
            cursor: pointer;
        }

        .cab-input-group {
            margin-top: 1rem;
        }

        .cab-input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #c0c0c0;
            font-size: 0.9rem;
        }

        .cab-input-group input[type="text"],
        .cab-input-group select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid #e94560;
            background-color: #33334c;
            color: #e0e0e0;
            margin-top: 0.5rem;
            outline: none;
        }

        .cab-input-group input[type="text"]::placeholder {
            color: #999;
        }

        .cab-input-group input[type="text"]:disabled,
        .cab-input-group select:disabled {
            background-color: #222;
            color: #777;
            border-color: #444;
            cursor: not-allowed;
        }

        /* Payment Methods */
        .payment-method {
            display: flex;
            align-items: center;
            background-color: #33334c;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s ease, background-color 0.2s ease;
        }

        .payment-method:hover {
            background-color: #44446a;
        }

        .payment-method.selected {
            border-color: #e94560;
            background-color: #44446a;
        }

        .payment-method input[type="radio"] {
            margin-right: 1rem;
            accent-color: #e94560; /* Style radio button itself */
        }

        .payment-method i {
            margin-right: 0.75rem;
            color: #e0e0e0;
            font-size: 1.5rem;
        }

        .payment-method span {
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* Message Box Styling (from watch.js, ensuring consistency) */
        .message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .message-box {
            background: #1a1a2e;
            color: #e0e0e0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 80%;
            font-family: 'Inter', sans-serif;
            border: 1px solid #e94560;
        }

        .message-box button {
            background-color: #e94560;
            color: #1a1a2e;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s ease;
        }

        .message-box button:hover {
            background-color: #ff6a80;
        }

        /* Price Update Section */
        .price-update-section {
            background-color: #222;
            border-radius: 8px;
            padding: 15px;
            margin-top: 1.5rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            border: 1px solid #e94560;
        }

        .price-update-section p {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
            color: #e0e0e0;
        }

        .price-update-section span {
            color: #e94560;
            font-size: 1.5rem;
            margin-left: 10px;
        }

        /* Snacks Section Horizontal Layout */
        #snacks-list {
            display: flex; /* Use flexbox for horizontal layout */
            flex-wrap: wrap; /* Allow items to wrap to the next line */
            justify-content: center; /* Center items */
            gap: 20px; /* Space between snack items */
            margin-top: 1.5rem;
        }

        .snack-item {
            background-color: #222;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: flex; /* Make snack item itself a flex container */
            align-items: center; /* Align items vertically in the center */
            padding: 10px;
            flex-basis: calc(50% - 10px); /* Two items per row, adjust for gap */
            max-width: 350px; /* Limit individual snack item width */
            box-sizing: border-box; /* Include padding in calculation */
        }

        .snack-item img {
            width: 80px; /* Smaller image size */
            height: 80px; /* Smaller image size */
            object-fit: cover;
            border-radius: 8px; /* Rounded corners for image */
            margin-right: 15px; /* Space between image and text */
            flex-shrink: 0; /* Prevent image from shrinking */
        }

        .snack-details {
            flex-grow: 1; /* Allows details to take up available space */
            text-align: left;
        }

        .snack-details h4 {
            margin: 0 0 5px 0;
            color: #e94560;
            font-size: 1.1rem;
        }

        .snack-details p {
            margin: 0;
            color: #c0c0c0;
            font-size: 0.95rem;
        }

        .snack-quantity-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto; /* Push quantity controls to the right */
            flex-shrink: 0;
        }

        .snack-quantity-control button {
            background-color: #e94560;
            color: #1a1a2e;
            border: none;
            border-radius: 50%;
            width: 28px; /* Slightly smaller buttons */
            height: 28px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .snack-quantity-control button:hover {
            background-color: #ff6a80;
        }

        .snack-quantity-control span {
            font-size: 1rem; /* Slightly smaller quantity text */
            font-weight: 600;
            color: #e0e0e0;
            min-width: 18px;
            text-align: center;
        }


        /* --- Footer Styles --- */
        .site-footer {
            background-color: var(--header-bg-light);
            color: var(--text-color-light);
            padding: 2rem 0;
            margin-top: auto;
            box-shadow: 0 -2px 5px var(--shadow-color-light);
            transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
        }

        body.dark-mode .site-footer {
            background-color: var(--header-bg-dark);
            color: var(--text-color-dark);
            box-shadow: 0 -2px 5px var(--shadow-color-dark);
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            text-align: center;
        }

        .footer-section h3 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        body.dark-mode .footer-section h3 {
            color: var(--accent-color);
        }

        .footer-section p,
        .footer-section a {
            font-size: 0.9rem;
            color: inherit;
            text-decoration: none;
            display: block;
            margin-bottom: 0.5rem;
            transition: color 0.3s ease;
        }

        .footer-section a:hover {
            color: var(--secondary-color);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color-light);
            margin-top: 2rem;
            font-size: 0.85rem;
            color: #888;
        }

        body.dark-mode .footer-bottom {
            border-top-color: var(--border-color-dark);
            color: #bbb;
        }

        .social-icons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 1rem;
        }

        .social-icons img {
            height: 30px;
            width: 30px;
        }

        .social-icons img:hover {
            transform: scale(1.1);
        }


        /* Animations */
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInOverlay {
            from { background: rgba(0, 0, 0, 0); backdrop-filter: blur(0px); }
            to { background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); }
        }

        @keyframes zoomIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* Media Queries for responsiveness */
        @media (max-width: 768px) {
            .stepper-container {
                flex-wrap: wrap;
                gap: 1rem;
            }
            .stepper-item {
                flex-basis: 45%; /* Two items per row */
            }
            .stepper-line {
                display: none; /* Hide line on small screens for simpler layout */
            }
            .main-content-padding {
                padding: 1rem;
            }
            #buyTicketHero h1 {
                font-size: 1.8rem;
            }
            .seats-grid {
                grid-template-columns: repeat(auto-fit, minmax(25px, 1fr)); /* More flexible seats */
            }
            .seat {
                width: 25px;
                height: 25px;
            }
            .snack-item {
                flex-basis: 100%; /* Stack snacks vertically on small screens */
                max-width: 100%;
            }
        }
    </style>
</head>
<body class="dark-mode">

    <!-- Custom Message Box Overlay (always present but hidden by default) -->
    <div id="customAlert" class="message-overlay" style="display: none;">
        <div class="alert-content">
            <i class="alert-icon fas"></i> <!-- Icon will be set by JS -->
            <p id="alertMessage"></p>
            <button id="closeAlert" class="close-alert-btn">OK</button>
        </div>
    </div>

    <!-- Main Header -->
    <header id="mainHeader">
        <div class="logo"><a href="cinewatch_home.html">CineWatch</a></div>
        <nav class="nav-icons">
            <i id="searchIcon" class="fas fa-search" title="Search"></i>
            <i id="addIcon" class="fas fa-plus-circle yellow-icon" title="Add to Watchlist"></i>
            <i id="accountIcon" class="fas fa-user-circle yellow-icon" title="Account"></i>
            <i id="darkModeToggle" class="fas fa-moon yellow-icon" title="Toggle Mode"></i>

            <!-- Account Dropdown Menu (initially hidden) -->
            <div id="accountDropdown" class="account-dropdown">
                <!-- Content will be dynamically added by JavaScript based on login status -->
            </div>
        </nav>
    </header>

    <!-- Search Subheader -->
    <div id="searchSubheader" class="hidden">
        <div class="search-bar-container">
            <input type="text" id="searchInput" placeholder="Search movies, shows..." autocomplete="off" />
            <i class="fas fa-microphone voice-icon" title="Voice Search"></i>
            <i id="clearSearch" class="fas fa-times clear-icon" title="Clear"></i>
        </div>
        <div id="suggestionsBox" class="suggestions-box"></div>
    </div>
    <!-- Hero Section -->
    <section id="buyTicketHero" style="background-image: url('https://placehold.co/900x300/333/fff?text=Loading...');">
        <h1 id="hero-movie-title">Loading Movie...</h1>
    </section>

    <div class="main-content-padding">
        <!-- Stepper -->
        <div class="stepper-container">
            <div class="stepper-line"></div>
            <div class="stepper-item active" data-step="1">
                <div class="step-circle"><span>1</span></div>
                <div class="step-label">Show Details</div>
            </div>
            <div class="stepper-item" data-step="2">
                <div class="step-circle"><span>2</span></div>
                <div class="step-label">Select Seats</div>
            </div>
            <div class="stepper-item" data-step="3">
                <div class="step-circle"><span>3</span></div>
                <div class="step-label">Snacks</div>
            </div>
            <div class="stepper-item" data-step="4">
                <div class="step-circle"><span>4</span></div>
                <div class="step-label">Cab Service</div>
            </div>
            <div class="stepper-item" data-step="5">
                <div class="step-circle"><span>5</span></div>
                <div class="step-label">Summary</div>
            </div>
            <div class="stepper-item" data-step="6">
                <div class="step-circle"><span>6</span></div>
                <div class="step-label">Payment</div>
            </div>
        </div>

        <!-- Total Price Update Section -->
        <div class="price-update-section">
            <p>Current Total: <span id="current-total-amount">Ksh 0.00</span></p>
        </div>


        <!-- Step 1: Movie Details -->
        <div id="step-movie-details" class="step-content">
            <h2 class="text-2xl font-bold text-center text-e94560 mb-4">Movie Details</h2>
            <div id="movie-details">
                <img id="movie-poster" src="https://placehold.co/250x350/333/fff?text=No+Poster" alt="Movie Poster">
                <div class="movie-info-text d-flex flex-col items-center text-center">
                    <h2 id="movie-title-display"></h2>
                    <p><strong>Genre:</strong> <span id="movie-genre"></span></p>
                    <p><strong>IMDb:</strong> <span id="movie-imdb"></span></p>
                    <p><strong>Release Date:</strong> <span id="movie-release-date"></span></p>
                    <p><strong>Director:</strong> <span id="movie-creators"></span></p>
                    <p><strong>Cast:</strong> <span id="movie-cast"></span></p>
                    <p><strong>Synopsis:</strong> <span id="movie-synopsis" class="text-sm"></span></p>
                </div>
            </div>
            <div class="action-buttons">
                <button class="proceed-btn" data-target-step="2">Proceed to Seats</button>
            </div>
        </div>

        <!-- Step 2: Select Seats -->
        <div id="step-select-seats" class="step-content hidden">
            <h2 class="text-2xl font-bold text-center text-e94560 mb-4">Select Your Seats</h2>
            <div class="seat-legend">
                <div class="legend-item"><div class="legend-color" style="background-color: #e94560;"></div> Selected</div>
                <div class="legend-item"><div class="legend-color" style="background-color: #555;"></div> Occupied</div>
                <div class="legend-item"><div class="legend-color" style="background-color: #28a745;"></div> Available</div>
            </div>
            <div class="screen-indicator">SCREEN THIS WAY</div>
            <div id="seats-container" class="seats-grid">
                <!-- Seats will be generated here by JS -->
            </div>
            <div class="action-buttons">
                <button class="back-btn" data-target-step="1">Back</button>
                <button class="proceed-btn" data-target-step="3" id="proceed-to-snacks-btn">Proceed to Snacks</button>
            </div>
        </div>

        <!-- Step 3: Snacks -->
        <div id="step-snacks" class="step-content hidden">
            <h2 class="text-2xl font-bold text-center text-e94560 mb-4">Add Snacks</h2>
            <div id="snacks-list">
                <!-- Snacks will be populated here by JS -->
            </div>
            <div class="action-buttons">
                <button class="back-btn" data-target-step="2">Back</button>
                <button class="proceed-btn" data-target-step="4">Proceed to Cab Service</button>
            </div>
        </div>

        <!-- Step 4: Cab Service -->
        <div id="step-cab-service" class="step-content hidden">
            <h2 class="text-2xl font-bold text-center text-e94560 mb-4">Need a Cab Service?</h2>
            <div class="cab-options">
                <div class="cab-option">
                    <input type="radio" id="cab-yes" name="cab-service" value="yes">
                    <label for="cab-yes">Yes, I need a cab</label>
                </div>
                <div class="cab-option">
                    <input type="radio" id="cab-no" name="cab-service" value="no" checked>
                    <label for="cab-no">No, thank you</label>
                </div>
            </div>

            <div id="cab-details" class="hidden mt-4 p-4 bg-gray-700 rounded-lg">
                <h3 class="text-xl font-bold mb-3">Cab Details</h3>
                <div class="cab-input-group mb-3">
                    <label for="pickup-type" class="block text-gray-300 text-sm font-bold mb-2">Pickup Type:</label>
                    <div class="flex items-center gap-4">
                        <input type="radio" id="pickup-home" name="pickup-type" value="home" class="mr-2">
                        <label for="pickup-home">Home</label>
                        <input type="radio" id="pickup-taxicab" name="pickup-type" value="taxicab" class="mr-2">
                        <label for="pickup-taxicab">Taxicab Stand</label>
                    </div>
                </div>
                <div class="cab-input-group mb-3 hidden" id="home-address-group">
                    <label for="home-address" class="block text-gray-300 text-sm font-bold mb-2">Home Address:</label>
                    <input type="text" id="home-address" placeholder="Enter your home address" class="w-full">
                </div>
                <div class="cab-input-group mb-3 hidden" id="taxicab-stand-group">
                    <label for="taxicab-stand" class="block text-gray-300 text-sm font-bold mb-2">Select Taxicab Stand:</label>
                    <select id="taxicab-stand" class="w-full">
                        <option value="">Select a stand</option>
                        <!-- Cab stands will be populated by JS based on cinema location -->
                    </select>
                </div>
                <div class="cab-input-group">
                    <label for="cab-provider" class="block text-gray-300 text-sm font-bold mb-2">Cab Provider:</label>
                    <select id="cab-provider" class="w-full">
                        <option value="">Select a provider</option>
                        <option value="Bolt">Bolt</option>
                        <option value="Uber">Uber</option>
                        <option value="Little Cab">Little Cab</option>
                    </select>
                </div>
            </div>
            <div class="action-buttons">
                <button class="back-btn" data-target-step="3">Back</button>
                <button class="proceed-btn" data-target-step="5" id="proceed-to-summary-btn">Proceed to Summary</button>
            </div>
        </div>

        <!-- Step 5: Order Summary -->
        <div id="step-order-summary" class="step-content hidden">
            <h2 class="text-2xl font-bold text-center text-e94560 mb-4">Order Summary</h2>
            <div id="summary-details" class="text-center">
                <p><strong>Movie:</strong> <span id="summary-movie-title"></span></p>
                <p><strong>Cinema:</strong> <span id="summary-cinema"></span></p>
                <p><strong>Selected Seats:</strong> <span id="summary-seats"></span></p>
                <p><strong>Snacks:</strong> <span id="summary-snacks"></span></p>
                <p><strong>Cab Service:</strong> <span id="summary-cab-service"></span></p>
                <p><strong>Total Amount:</strong> <span id="summary-total-amount" class="text-2xl"></span></p>
            </div>
            <div class="action-buttons">
                <button class="back-btn" data-target-step="4">Back</button>
                <button id="proceed-to-payment-btn" class="proceed-btn" data-target-step="6">Proceed to Payment</button>
            </div>
        </div>

        <!-- Step 6: Payment Method -->
        <div id="step-payment-method" class="step-content hidden">
            <h2 class="text-2xl font-bold text-center text-e94560 mb-4">Select Payment Method</h2>
            <div id="payment-methods" class="flex flex-col gap-3">
                <div class="payment-method" data-method="Mpesa">
                    <input type="radio" id="payment-mpesa" name="payment-method" value="Mpesa">
                    <i class="fas fa-mobile-alt"></i>
                    <span>M-Pesa</span>
                </div>
                <div class="payment-method" data-method="Card">
                    <input type="radio" id="payment-card" name="payment-method" value="Card">
                    <i class="fas fa-credit-card"></i>
                    <span>Credit/Debit Card</span>
                </div>
                <div class="payment-method" data-method="Paypal">
                    <input type="radio" id="payment-paypal" name="payment-method" value="Paypal">
                    <i class="fab fa-paypal"></i>
                    <span>PayPal</span>
                </div>
            </div>
            <div class="action-buttons">
                <button class="back-btn" data-target-step="5">Back</button>
                <button class="proceed-btn" id="final-pay-now-btn">Pay Now</button>
            </div>
        </div>
    </div>
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-section centered-info">
                <p>&copy; Copyright Alex Malunda 2025</p>
                <p><a href="privacy.html" target="_blank" rel="noopener noreferrer">Privacy Notice</a></p>
                <p><a href="sources.html" target="_blank" rel="noopener noreferrer">Sources</a></p>
                <p>Last Modified: <span id="last-modified"></span></p>
            </div>
            <div class="footer-section social-links">
                <a href="developer.html" target="_blank" rel="noopener noreferrer">About the Developer</a>
                <div class="social-icons">
                    <a href="https://www.instagram.com/yourprofile" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
                        <img src="images/icons&logos/instagram_24dp.svg" alt="Instagram">
                    </a>
                    <a href="https://www.facebook.com/yourprofile" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
                        <img src="images/icons&logos/facebook_24dp.svg" alt="Facebook">
                    </a>
                    <a href="https://www.linkedin.com/in/yourprofile" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
                        <img src="images/icons&logos/linkedin_24dp.svg" alt="LinkedIn">
                    </a>
                    <a href="https://x.com/yourprofile" target="_blank" rel="noopener noreferrer" aria-label="X (formerly Twitter)">
                        <img src="images/icons&logos/twitter_24dp.svg" alt="X (formerly Twitter)">
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Data for all shows (copied from cinema_guide.html to keep consistent)
        const allShows = [
            {
                title: "Money Heist (La Casa de Papel)",
                categories: ["Trending", "International"],
                poster: "moneyheistposter.webp", // Selected .webp poster
                backdrop: "moneyheistbackdrop1.webp", // Selected .webp backdrop
                imdb: "8.2/10 (Crime)",
                releaseDate: "May 2, 2017",
                seasons: "5 (Netflix Parts)",
                episodes: "41",
                languages: "Spanish",
                genre: "Heist, Crime, Drama, Thriller",
                creators: "Alex Pina",
                cast: "Úrsula Corberó, Álvaro Morte, Itziar Ituño",
                networkLogo: "netflixlogo.webp",
                networkText: "Watch Now",
                subscription: "Subscription Required",
                synopsis: "A mysterious man known as 'The Professor' recruits a band of eight robbers to carry out an ambitious plan: to steal billions of euros from the Royal Mint of Spain. As the heist unfolds, the team grapples with hostages, police, and personal conflicts, turning the robbery into a complex game of cat and mouse. Known for its intricate plot twists and strong character development."
            },
            {
                title: "Money Heist (K-Drama)",
                categories: ["K-Drama", "Coming Soon"],
                poster: "moneyheistkoreaposter1.webp", // Selected .webp poster
                backdrop: "moneheistkoreabackdrop1.webp", // Selected .webp backdrop
                imdb: "Expected",
                releaseDate: "Expected Premier: December 2024 (Season 2)",
                seasons: "2 (Expected)",
                episodes: "N/A",
                languages: "Korean",
                genre: "Heist, Crime, Drama, Thriller",
                creators: "Kim Hong-sun",
                cast: "Yoo Ji-tae, Kim Yun-jin, Park Hae-soo",
                networkLogo: "youtubelogo.webp",
                networkText: "Watch Trailer",
                subscription: "Free",
                synopsis: "A Korean adaptation of the hit Spanish series, 'Money Heist', this version reinterprets the original's compelling narrative with a fresh, distinct Korean perspective, focusing on a major heist orchestrated by the Professor and his team of diverse personalities. Fans eagerly await the next installment."
            },
            {
                title: "Prison Break",
                categories: ["Action", "Hollywood"],
                poster: "prisonbreakposter1.webp", // Selected .webp poster
                backdrop: "prisonbreakbackdrop.webp", // Selected .webp backdrop
                imdb: "8.3/10 (Action)",
                releaseDate: "August 29, 2005",
                seasons: "5",
                episodes: "90",
                languages: "English",
                genre: "Action, Crime, Drama, Thriller",
                creators: "Paul Scheuring",
                cast: "Wentworth Miller, Dominic Purcell, Amaury Nolasco",
                networkLogo: "hululogo.webp",
                networkText: "Watch Now",
                subscription: "Subscription Required",
                synopsis: "When his brother, Lincoln Burrows, is wrongly sentenced to death, a structural engineer, Michael Scofield, devises an elaborate plan to break him out of prison—starting by getting incarcerated himself. A thrilling ride full of twists, tension, and brotherly loyalty as they navigate their escape and evade authorities."
            },
            {
                title: "Inception",
                categories: ["Hollywood"],
                poster: "inceptioposter1.webp", // Selected .webp poster
                backdrop: "inceptionbackdrop1.webp", // Selected .webp backdrop
                imdb: "8.8/10 (Sci-Fi)",
                releaseDate: "July 16, 2010",
                seasons: "1 (Film)",
                episodes: "N/A (Film)",
                languages: "English",
                genre: "Action, Sci-Fi, Thriller",
                creators: "Christopher Nolan",
                cast: "Leonardo DiCaprio, Joseph Gordon-Levitt, Elliot Page",
                networkLogo: "hbo.webp", // HBO Max or rent/buy
                networkText: "Watch Now",
                subscription: "Subscription/Rent/Buy",
                synopsis: "A thief who steals corporate secrets through use of dream-sharing technology is given the inverse task of planting an idea into the mind of a C.E.O., but his tragic past may doom the mission and his team to disaster."
            },
            {
                title: "Breaking Bad",
                categories: ["Trending", "Hollywood"],
                poster: "breakingbadposter1.webp", // Selected .webp poster
                backdrop: "breakingbadbackdrop.webp", // Selected .webp backdrop
                imdb: "9.5/10 (Crime)",
                releaseDate: "January 20, 2008",
                seasons: "5",
                episodes: "62",
                languages: "English",
                genre: "Crime, Drama, Thriller",
                creators: "Vince Gilligan",
                cast: "Bryan Cranston, Aaron Paul, Anna Gunn",
                networkLogo: "netflixlogo.webp",
                networkText: "Watch Now",
                subscription: "Subscription Required",
                synopsis: "Breaking Bad follows Walter White, a high school chemistry teacher turned methamphetamine producer, as he partners with former student Jesse Pinkman. Faced with a cancer diagnosis and financial hardship, Walter descends into a criminal underworld that transforms his identity and relationships, exploring themes of morality, family, and ambition."
            },
            {
                title: "The Office",
                categories: ["Hollywood"],
                poster: "theofficeposter1.webp", // Selected .webp poster
                backdrop: "theofficebackdrop1.webp", // Selected .webp backdrop
                imdb: "9.0/10 (Comedy)",
                releaseDate: "March 24, 2005",
                seasons: "9",
                episodes: "201",
                languages: "English",
                genre: "Comedy",
                creators: "Ricky Gervais, Stephen Merchant, Greg Daniels",
                cast: "Steve Carell, Rainn Wilson, John Krasinski",
                networkLogo: "pecock-logo.webp", // Assuming Peacock (US)
                networkText: "Watch Now",
                subscription: "Subscription Required",
                synopsis: "A mockumentary on a group of typical office workers, where the workday consists of ego clashes, inappropriate behavior, and tedium. The everyday lives of the employees are seen through the lens of a documentary film crew."
            },
            {
                title: "Your Honor",
                categories: ["Hollywood", "Coming Soon"],
                poster: "yourhonorposter1.webp", // Selected .webp poster
                backdrop: "yourhonorbackdrop1.webp", // Selected .webp backdrop
                imdb: "Expected",
                releaseDate: "Expected Premier: Coming Soon (Season 3)",
                seasons: "3 (Expected)",
                episodes: "N/A",
                languages: "English",
                genre: "Crime, Drama, Thriller",
                creators: "Peter Moffat",
                cast: "Bryan Cranston",
                networkLogo: "youtubelogo.webp",
                networkText: "Watch Trailer",
                subscription: "Free",
                synopsis: "A respected New Orleans judge's life is turned upside down when his teenage son is involved in a hit-and-run, leading to a high-stakes game of lies, deceit, and impossible choices to protect his family. Season 3 is highly anticipated."
            },
            {
                title: "3 Idiots",
                categories: ["Bollywood"],
                poster: "3idiotsposter1.webp", // Selected .webp poster
                backdrop: "3idiotsbackdrop1.webp", // Selected .webp backdrop
                imdb: "8.4/10 (Comedy)",
                releaseDate: "December 25, 2009",
                seasons: "1 (Film)",
                episodes: "N/A (Film)",
                languages: "Hindi",
                genre: "Comedy, Drama, Romance",
                creators: "Rajkumar Hirani",
                cast: "Aamir Khan, Madhavan, Sharman Joshi",
                networkLogo: "primevideologo.webp", // Assuming Prime Video
                networkText: "Watch Now",
                subscription: "Subscription/Rent/Buy",
                synopsis: "Two friends embark on a quest for a third, long-lost friend, while reminiscing about their college days and the profound impact their eccentric, brilliant buddy had on their lives and perspectives on education and success."
            },
            {
                title: "Ghoul",
                categories: ["Bollywood"],
                poster: "ghoulposter1.webp", // Selected .webp poster
                backdrop: "ghoulbackdrop1.webp", // Selected .webp backdrop
                imdb: "7.1/10 (Horror)",
                releaseDate: "August 24, 2018",
                seasons: "1",
                episodes: "3",
                languages: "Hindi, English",
                genre: "Horror, Thriller",
                creators: "Patrick Graham",
                cast: "Radhika Apte, Manav Kaul, Ratnabali Bhattacharjee",
                networkLogo: "netflixlogo.webp",
                networkText: "Watch Now",
                subscription: "Subscription Required",
                synopsis: "A newly appointed interrogator arrives at a remote military detention center to question a dangerous terrorist, only to discover that the detainee is not what he seems and harbors a terrifying supernatural entity."
            },
            {
                title: "Dangal",
                categories: ["Bollywood"],
                poster: "dangalposter1.webp", // Selected .webp poster
                backdrop: "dangalbackdrop1.webp", // Selected .webp backdrop
                imdb: "8.3/10 (Biography)",
                releaseDate: "December 23, 2016",
                seasons: "1 (Film)",
                episodes: "N/A (Film)",
                languages: "Hindi",
                genre: "Biography, Drama, Sport",
                creators: "Nitesh Tiwari",
                cast: "Aamir Khan, Fatima Sana Shaikh, Sanya Malhotra",
                networkLogo: "netflixlogo.webp", // Also available on Netflix
                networkText: "Watch Now",
                subscription: "Subscription/Rent/Buy",
                synopsis: "Based on the true story of Mahavir Singh Phogat, a former wrestler who trains his daughters Geeta Phogat and Babita Kumari to become world-class female wrestlers, challenging societal norms and achieving international success."
            },
            {
                title: "Nairobi Half Life",
                categories: ["Kenyan Drama"],
                poster: "nairobihalflifeposter1.webp", // Selected .webp poster
                backdrop: "nairobihalflifebackdrop1.webp", // Selected .webp backdrop
                imdb: "7.8/10 (Crime)",
                releaseDate: "October 31, 2012",
                seasons: "1 (Film)",
                episodes: "N/A (Film)",
                languages: "Swahili, Kikuyu, English",
                genre: "Crime, Drama",
                creators: "David 'Tosh' Gitonga (Director)",
                cast: "Joseph Wairimu, Olwenya Maina, Mugambi Nthiga",
                networkLogo: "youtubelogo.webp", // Often available on YouTube or local VOD
                networkText: "Watch Now",
                subscription: "May require Rent/Buy",
                synopsis: "Nairobi Half Life tells the story of Mwas, an aspiring actor from a rural town who travels to Nairobi to pursue his dreams. Faced with harsh city life, he’s pulled into a world of crime and must struggle to stay true to his dreams while surviving the city’s brutal realities. It's a powerful and gritty portrayal of urban life in Kenya."
            },
            {
                title: "Crime and Justice",
                categories: ["Kenyan Drama", "Trending", "Coming Soon"],
                poster: "crimeandjusticeposter1.webp", // Selected .webp poster
                backdrop: "crimeandjusticebackdrop1.webp", // Selected .webp backdrop
                imdb: "7.0/10 (Crime)", // Estimate, as IMDb doesn't show a clear rating
                releaseDate: "February 22, 2021",
                seasons: "3", // As of my last update
                episodes: "N/A",
                languages: "English, Swahili",
                genre: "Crime, Drama, Legal",
                creators: "Showmax Original",
                cast: "Sarah Hassan, Alfred Munyua, Maqbul Mohammed",
                networkLogo: "showmaxlogo.webp", // Assuming Showmax logo if you have it
                networkText: "Watch Now",
                subscription: "Subscription Required",
                synopsis: "A Kenyan police procedural series that follows two detectives as they investigate various crimes in Nairobi. The show delves into the dark side of the city, exploring themes of corruption, greed, and the pursuit of justice."
            },
            {
                title: "The Day Of The Jackal",
                categories: ["International", "Coming Soon"],
                poster: "thedayofthejackalposter1.webp", // Selected .webp poster
                backdrop: "thedayofthejackalbackdrop1.webp", // Selected .webp backdrop
                imdb: "Expected",
                releaseDate: "Expected Premier: November 2024 (Series)",
                seasons: "1 (Upcoming Series)",
                episodes: "N/A",
                languages: "English",
                genre: "Thriller",
                creators: "Ronan Bennett",
                cast: "Eddie Redmayne, Lashana Lynch",
                networkLogo: "pecock-logo.webp", // SkyShowtime/Peacock
                networkText: "Watch Trailer",
                subscription: "Free",
                synopsis: "An upcoming modern-day reimagining of the iconic novel and film, following a professional assassin known as 'The Jackal' as he undertakes a mission to assassinate a high-profile target."
            },
            {
                title: "Train To Busan",
                categories: ["K-Drama"],
                poster: "traintobusanposter2.webp", // Selected .webp poster
                backdrop: "traintobusanbackdrop1.webp", // Selected .webp backdrop
                imdb: "7.6/10 (Action)",
                releaseDate: "July 20, 2016",
                seasons: "1 (Film)",
                episodes: "N/A (Film)",
                languages: "Korean",
                genre: "Action, Horror, Thriller",
                creators: "Yeon Sang-ho (Director)",
                cast: "Gong Yoo, Jung Yu-mi, Ma Dong-seok",
                networkLogo: "amazon-prime-logo-free-png.webp", // Often on Prime/Hulu
                networkText: "Watch Now",
                subscription: "Subscription/Rent/Buy",
                synopsis: "While a zombie apocalypse breaks out in South Korea, a father and daughter, along with other passengers, are trapped on a high-speed train fighting for their lives as the infection spreads rapidly."
            },
            {
                title: "Extraction",
                categories: ["Hollywood", "Coming Soon"],
                poster: "extractionposter1.webp", // Selected .webp poster
                backdrop: "extractionbackdrop1.webp", // Selected .webp backdrop
                imdb: "Expected",
                releaseDate: "Expected Premier: 2025 (Extraction 3)",
                seasons: "3 (Expected)",
                episodes: "N/A",
                languages: "English",
                genre: "Action, Thriller",
                creators: "Sam Hargrave (Director)",
                cast: "Chris Hemsworth",
                networkLogo: "youtubelogo.webp",
                networkText: "Watch Trailer",
                subscription: "Free",
                synopsis: "Extraction follows a black market mercenary who embarks on a deadly mission to rescue the kidnapped son of an imprisoned international crime lord. The highly anticipated third installment will continue the high-octane action."
            },
            {
                title: "All Of Us Are Dead",
                categories: ["K-Drama", "Coming Soon"],
                poster: "allofusaredeadposter1.webp", // Selected .webp poster
                backdrop: "squidgamebackdrop1.webp", // Using a general zombie/thriller backdrop since no direct match was provided
                imdb: "Expected",
                releaseDate: "Expected Premier: 2025 (Season 2)",
                seasons: "2 (Expected)",
                episodes: "N/A",
                languages: "Korean",
                genre: "Action, Drama, Horror",
                creators: "Lee Jae-kyoo, Kim Nam-su",
                cast: "Park Ji-hu, Yoon Chan-young, Cho Yi-hyun",
                networkLogo: "youtubelogo.webp",
                networkText: "Watch Trailer",
                subscription: "Free",
                synopsis: "When a zombie virus breaks out in a high school, trapped students must fight their way out or turn into one of the infected. The second season is set to continue their struggle for survival."
            },
            {
                title: "Stranger Things",
                categories: ["Hollywood"],
                poster: "strangerthingsposter1.webp", // Selected .webp poster
                backdrop: "strangerthingsbackdrop1.webp", // Selected .webp backdrop
                imdb: "8.7/10 (Drama)",
                releaseDate: "July 15, 2016",
                seasons: "5",
                episodes: "34",
                languages: "English",
                genre: "Drama, Fantasy, Horror",
                creators: "The Duffer Brothers",
                cast: "Millie Bobby Brown, Finn Wolfhard, Winona Ryder",
                networkLogo: "netflixlogo.webp",
                networkText: "Watch Now",
                subscription: "Subscription Required",
                synopsis: "When a young boy vanishes, a small town uncovers a mystery involving secret experiments, terrifying supernatural forces, and one strange little girl with extraordinary powers."
            },
            {
                title: "Lupin",
                categories: ["International"],
                poster: "lupinposter1.webp", // Selected .webp poster
                backdrop: "lupinbackdrop1.webp", // Selected .webp backdrop
                imdb: "7.5/10 (Crime)",
                releaseDate: "January 8, 2021",
                seasons: "3 (Parts)",
                episodes: "17",
                languages: "French",
                genre: "Crime, Drama, Mystery",
                creators: "George Kay, François Uzan",
                cast: "Omar Sy, Ludivine Sagnier, Clotilde Hesme",
                networkLogo: "netflixlogo.webp",
                networkText: "Watch Now",
                subscription: "Subscription Required",
                synopsis: "Inspired by the adventures of Arsène Lupin, master of disguise and gentleman thief Assane Diop sets out to avenge his father for an injustice inflicted by a wealthy family."
            },
            {
                title: "Squid Game",
                categories: ["Trending", "K-Drama", "Coming Soon"],
                poster: "squidgameposter1.webp", // Selected .webp poster
                backdrop: "squidgamebackdrop1.webp", // Selected .webp backdrop
                imdb: "8.0/10 (Action)",
                releaseDate: "September 17, 2021",
                seasons: "2 (Expected)", // Season 2 is coming soon
                episodes: "9 (Season 1)",
                languages: "Korean",
                genre: "Action, Thriller, Drama",
                creators: "Hwang Dong-hyuk",
                cast: "Lee Jung-jae, Park Hae-soo, Jung Ho-yeon",
                networkLogo: "netflixlogo.webp",
                networkText: "Watch Now", // For Season 1
                subscription: "Subscription Required",
                synopsis: "When a man with a huge debt is invited to play a series of children's games for a life-changing sum of money. The catch is, losing means death. The second season is highly anticipated."
            },
            {
                title: "Second Wife",
                categories: ["Kenyan Drama", "Coming Soon"],
                poster: "secondfamilyposter1.webp", // Selected .webp poster
                backdrop: "secondfamilybackdrop1.webp", // Selected .webp backdrop
                imdb: "Expected",
                releaseDate: "Expected Premier: TBA",
                seasons: "N/A",
                episodes: "N/A",
                languages: "Swahili, English",
                genre: "Drama",
                creators: "N/A",
                cast: "N/A",
                networkLogo: "youtubelogo.webp",
                networkText: "Watch Trailer",
                subscription: "Free",
                synopsis: "Details for 'Second Wife' are scarce, but it's expected to be a compelling Kenyan drama exploring familial and marital complexities, possibly revolving around the theme of polygamy or a new spouse in a family."
            },
            {
                title: "40 Sticks",
                categories: ["Kenyan Drama"],
                poster: "40sticksposter1.webp", // Selected .webp poster
                backdrop: "crimeandjusticebackdrop1.webp", // Using a general crime/drama backdrop since no direct match was provided
                imdb: "6.2/10 (Action)",
                releaseDate: "October 2, 2020",
                seasons: "1 (Film)",
                episodes: "N/A (Film)",
                languages: "Swahili, English",
                genre: "Action, Crime, Thriller",
                creators: "Victor Gatonye (Director)",
                cast: "Robert Agengo, Mwaura Bilal, Andreo Kamau",
                networkLogo: "netflixlogo.webp",
                networkText: "Watch Now",
                subscription: "Subscription Required",
                synopsis: "When a prison bus crashes in the middle of a forest, a group of convicts must work together to survive the harsh wilderness while evading an unknown, deadly threat lurking in the shadows."
            }
        ];

        // Mock data for snacks
        const snacksData = [
            // Updated image paths to point to your local .webp files
            { id: "popcorn-large", name: "Large Popcorn", price: 500, image: "popcorns.webp" },
            { id: "soda-coke", name: "Coca-Cola", price: 200, image: "cocacola.webp" },
            { id: "nachos", name: "Nachos with Cheese", price: 450, image: "nachos.webp" },
            { id: "water-bottle", name: "Bottled Water", price: 100, image: "bottledwater.webp" },
        ];

        // Mock data for cinemas (used for welcome message on final step)
        const cinemaData = [
            { name: 'Century Cinemax Garden City', city: 'Nairobi', welcomeMessage: 'Welcome to Century Cinemax Garden City! We are thrilled to have you!' },
            { name: 'Anga Diamond Plaza', city: 'Nairobi', welcomeMessage: 'Enjoy your movie at Anga Diamond Plaza! Your comfort is our priority.' },
            { name: 'IMAX Two Rivers', city: 'Nairobi', welcomeMessage: 'Experience cinema like never before at IMAX Two Rivers! Get ready for an immersive journey.' },
            { name: 'Nyali Cinemax', city: 'Mombasa', welcomeMessage: 'Greetings from Nyali Cinemax! We hope you have a fantastic time.' },
            { name: 'Cinemax Mombasa', city: 'Mombasa', welcomeMessage: 'Welcome to Cinemax Mombasa! Get ready for a cinematic adventure.' },
            { name: 'Mega City Cinemas', city: 'Kisumu', welcomeMessage: 'Enjoy your visit to Mega City Cinemas! We\'re glad you\'re here.' },
            { name: 'Eldoret Cinemax', city: 'Eldoret', welcomeMessage: 'Welcome to Eldoret Cinemax! Your ultimate entertainment awaits.' },
        ];

        // Random cab stands data by city
        const cabStands = {
            'Nairobi': [
                'Nyayo Stadium Cab Stand',
                'Britam Towers Upperhill Cab Stand',
                'Westlands Cab Stand',
                'Thika Road Mall Cab Stand'
            ],
            'Mombasa': [
                'Serena Cab Stand',
                'Peketoni Cab Stand',
                'Bombolulu Cab Stand',
                'Kwa Paka Cab Stand'
            ],
            'Kisumu': [
                'Maisha London Cab Stand',
                'Airport Cab Stand',
                'Nyalenda Cab Stand',
                'Dunga Beach Cab Stand'
            ],
            'Eldoret': [
                'Roadblock Cab Stand',
                'Laxo Cab Stand',
                'Langas Cab Stand',
                'Kapsoya Cab Stand'
            ]
        };


        // Global variables for selected items
        let selectedMovieTitle = '';
        let selectedCinemaName = '';
        let selectedCinemaCity = ''; // New variable to store cinema city
        let selectedSeats = [];
        let selectedSnacks = {}; // { snackId: quantity }
        let cabServiceEnabled = false;
        let selectedPickupType = ''; // 'home' or 'taxicab'
        let selectedCabProvider = '';
        let totalAmount = 0;
        let selectedPaymentMethod = '';

        // Current step tracking
        let currentStep = 1;
        const totalSteps = 6;

        // Global variables for header search functionality
        let searchScope = null;
        let selectedIndex = -1;
        let userLoggedIn = true; // Placeholder, adjust as needed for actual login
        let currentUsername = "Jane Doe"; // Updated default username

        /**
         * Function to display a custom message box (replaces alert()).
         * @param {string} message - The message to display.
         * @param {string} [iconClass='fas fa-info-circle blue-icon'] - Font Awesome icon class.
         */
        function showMessageBox(message, iconClass = 'fas fa-info-circle blue-icon') {
            const customAlert = document.getElementById('customAlert');
            const alertMessage = document.getElementById('alertMessage');
            const alertIcon = customAlert.querySelector('.alert-icon');
            const closeAlertBtn = document.getElementById('closeAlert');

            if (!customAlert || !alertMessage || !alertIcon || !closeAlertBtn) {
                console.error("Custom alert elements not found. Cannot display message box.");
                // Fallback to browser alert if elements are missing
                alert(message);
                return;
            }

            alertMessage.textContent = message;
            // Remove previous icon classes and add new ones
            alertIcon.className = 'alert-icon'; // Reset to base class
            iconClass.split(' ').forEach(cls => alertIcon.classList.add(cls)); // Add new classes

            customAlert.style.display = 'flex'; // Show the overlay
            customAlert.classList.add('show'); // Trigger CSS fade/zoom

            // Ensure only one listener is active at a time
            const existingClickListener = customAlert.dataset.closeListener;
            if (existingClickListener) {
                closeAlertBtn.removeEventListener('click', window[existingClickListener]);
            }
            
            const newCloseHandler = () => {
                customAlert.classList.remove('show');
                setTimeout(() => { customAlert.style.display = 'none'; }, 300); // Hide after transition
            };
            // Assign a unique name to the handler if possible or just use anonymous
            const handlerName = `closeAlertHandler_${Date.now()}`;
            window[handlerName] = newCloseHandler; // Make it globally accessible for removal
            closeAlertBtn.addEventListener('click', newCloseHandler);
            customAlert.dataset.closeListener = handlerName;

            // Auto-hide after 5 seconds (optional)
            if (customAlert.dataset.hideTimeout) {
                clearTimeout(customAlert.dataset.hideTimeout);
            }
            customAlert.dataset.hideTimeout = setTimeout(() => {
                if (customAlert.classList.contains('show')) {
                    customAlert.classList.remove('show');
                    setTimeout(() => { customAlert.style.display = 'none'; }, 300);
                }
            }, 5000);
        }

        /**
         * Navigates to a specific step in the ticket buying process.
         * @param {number} stepNum - The number of the step to navigate to.
         */
        function navigateToStep(stepNum) {
            if (stepNum < 1 || stepNum > totalSteps) {
                console.error("Invalid step number:", stepNum);
                return;
            }

            // Mark previous step as completed if moving forward
            if (stepNum > currentStep) {
                const prevStepperItem = document.querySelector(`.stepper-item[data-step="${currentStep}"]`);
                if (prevStepperItem) {
                    prevStepperItem.classList.add('completed');
                }
            } else if (stepNum < currentStep) { // If moving backward, remove completed status from future steps
                 for (let i = currentStep; i > stepNum; i--) {
                    const futureStepperItem = document.querySelector(`.stepper-item[data-step="${i}"]`);
                    if (futureStepperItem) {
                        futureStepperItem.classList.remove('completed');
                    }
                }
            }


            document.querySelectorAll('.step-content').forEach(stepContent => {
                stepContent.classList.add('hidden');
            });

            document.querySelectorAll('.stepper-item').forEach(item => {
                item.classList.remove('active');
            });

            document.getElementById(`step-${getStepId(stepNum)}`).classList.remove('hidden');
            document.querySelector(`.stepper-item[data-step="${stepNum}"]`).classList.add('active');

            currentStep = stepNum;

            // Update price display and summary
            updateCurrentTotalAmount();
            if (currentStep === 5) {
                updateOrderSummary();
            }
        }

        /**
         * Helper function to get the ID string for a given step number.
         * @param {number} stepNum - The step number.
         * @returns {string} The ID string.
         */
        function getStepId(stepNum) {
            switch (stepNum) {
                case 1: return 'movie-details';
                case 2: return 'select-seats';
                case 3: return 'snacks';
                case 4: return 'cab-service';
                case 5: return 'order-summary';
                case 6: return 'payment-method';
                default: return '';
            }
        }

        /**
         * Renders the seats grid for selection.
         * @param {number} rows - Number of rows.
         * @param {number} cols - Number of columns.
         */
        function renderSeats(rows, cols) {
            const seatsContainer = document.getElementById('seats-container');
            seatsContainer.innerHTML = ''; // Clear existing seats

            // Mock occupied seats (for demonstration)
            const occupiedSeats = new Set(['A5', 'B3', 'C7', 'D1', 'D2', 'F10', 'H4']);

            for (let r = 0; r < rows; r++) {
                const rowChar = String.fromCharCode(65 + r); // A, B, C...
                for (let c = 1; c <= cols; c++) {
                    const seatId = `${rowChar}${c}`;
                    const seatDiv = document.createElement('div');
                    seatDiv.classList.add('seat');
                    seatDiv.textContent = c; // Display column number

                    if (occupiedSeats.has(seatId)) {
                        seatDiv.classList.add('occupied');
                    } else {
                        seatDiv.classList.add('available'); // Mark as available
                        seatDiv.addEventListener('click', () => {
                            seatDiv.classList.toggle('selected');
                            seatDiv.classList.toggle('available'); // Toggle available class too
                            if (seatDiv.classList.contains('selected')) {
                                selectedSeats.push(seatId);
                            } else {
                                selectedSeats = selectedSeats.filter(seat => seat !== seatId);
                            }
                            // Keep selected seats sorted
                            selectedSeats.sort((a, b) => {
                                const rowA = a.charCodeAt(0);
                                const rowB = b.charCodeAt(0);
                                if (rowA === rowB) {
                                    return parseInt(a.substring(1)) - parseInt(b.substring(1));
                                }
                                return rowA - rowB;
                            });
                            updateCurrentTotalAmount(); // Update total amount on seat change
                        });
                    }
                    seatsContainer.appendChild(seatDiv);
                }
            }
        }

        /**
         * Renders the available snacks.
         */
        function renderSnacks() {
            const snacksListContainer = document.getElementById('snacks-list');
            snacksListContainer.innerHTML = ''; // Clear existing snacks

            snacksData.forEach(snack => {
                const snackCard = document.createElement('div');
                snackCard.classList.add('snack-item'); // Use the new snack-item class

                snackCard.innerHTML = `
                    <img src="images/snacks/${snack.image}" alt="${snack.name}" onerror="this.onerror=null;this.src='https://placehold.co/80x80/e94560/fff?text=No+Image';">
                    <div class="snack-details">
                        <h4>${snack.name}</h4>
                        <p>Ksh ${snack.price.toFixed(2)}</p>
                    </div>
                    <div class="snack-quantity-control">
                        <button class="remove-snack-btn" data-snack-id="${snack.id}">-</button>
                        <span id="quantity-${snack.id}">${selectedSnacks[snack.id] || 0}</span>
                        <button class="add-snack-btn" data-snack-id="${snack.id}">+</button>
                    </div>
                `;
                snacksListContainer.appendChild(snackCard);
            });

            // Add event listeners for snack quantity buttons
            document.querySelectorAll('.add-snack-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const snackId = event.target.dataset.snackId;
                    selectedSnacks[snackId] = (selectedSnacks[snackId] || 0) + 1;
                    document.getElementById(`quantity-${snackId}`).textContent = selectedSnacks[snackId];
                    updateCurrentTotalAmount(); // Update total amount on snack change
                });
            });

            document.querySelectorAll('.remove-snack-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const snackId = event.target.dataset.snackId;
                    if (selectedSnacks[snackId] && selectedSnacks[snackId] > 0) {
                        selectedSnacks[snackId]--;
                        document.getElementById(`quantity-${snackId}`).textContent = selectedSnacks[snackId];
                        updateCurrentTotalAmount(); // Update total amount on snack change
                    }
                });
            });
        }

        /**
         * Calculates and updates the current total amount displayed at each step.
         */
        function updateCurrentTotalAmount() {
            let seatsCost = selectedSeats.length * 700; // Assuming 700 Ksh per ticket
            let snacksCost = 0;
            Object.keys(selectedSnacks).forEach(id => {
                const snack = snacksData.find(s => s.id === id);
                if (snack) {
                    snacksCost += snack.price * selectedSnacks[id];
                }
            });

            let cabCost = 0;
            if (cabServiceEnabled) {
                // Simplified cab cost logic for demonstration
                if (selectedPickupType === 'home') {
                    cabCost = 300;
                } else if (selectedPickupType === 'taxicab') {
                    cabCost = 150;
                }
            }
            totalAmount = seatsCost + snacksCost + cabCost;
            document.getElementById('current-total-amount').textContent = `Ksh ${totalAmount.toFixed(2)}`;
        }

        /**
         * Updates the order summary details.
         */
        function updateOrderSummary() {
            document.getElementById('summary-movie-title').textContent = selectedMovieTitle;
            document.getElementById('summary-cinema').textContent = selectedCinemaName;
            document.getElementById('summary-seats').textContent = selectedSeats.length > 0 ? selectedSeats.join(', ') : 'None';

            let snacksSummary = 'None';
            let snacksCost = 0;
            const chosenSnacks = Object.keys(selectedSnacks).filter(id => selectedSnacks[id] > 0);
            if (chosenSnacks.length > 0) {
                snacksSummary = chosenSnacks.map(id => {
                    const snack = snacksData.find(s => s.id === id);
                    snacksCost += snack.price * selectedSnacks[id];
                    return `${snack.name} (x${selectedSnacks[id]})`;
                }).join(', ');
            }
            document.getElementById('summary-snacks').textContent = snacksSummary;

            let cabServiceSummary = 'No';
            let cabCost = 0;
            if (cabServiceEnabled) {
                cabServiceSummary = `Yes - Provider: ${selectedCabProvider || 'N/A'}`;
                if (selectedPickupType === 'home') {
                    const homeAddress = document.getElementById('home-address').value;
                    cabServiceSummary += ` (Home Address: ${homeAddress || 'Not provided'})`;
                    cabCost = 300; // Example flat rate for home pickup
                } else if (selectedPickupType === 'taxicab') {
                    const taxicabStand = document.getElementById('taxicab-stand').value;
                    cabServiceSummary += ` (Taxicab Stand: ${taxicabStand || 'Not selected'})`;
                    cabCost = 150; // Example flat rate for taxicab stand pickup
                }
            }
            document.getElementById('summary-cab-service').textContent = cabServiceSummary;

            // Recalculate total amount for summary (should be same as currentTotalAmount)
            totalAmount = (selectedSeats.length * 700) + snacksCost + cabCost;
            document.getElementById('summary-total-amount').textContent = `Ksh ${totalAmount.toFixed(2)}`;
        }

        /**
         * Populates the taxicab stand dropdown based on the selected cinema's city.
         */
        function populateCabStands() {
            const taxicabStandSelect = document.getElementById('taxicab-stand');
            taxicabStandSelect.innerHTML = '<option value="">Select a stand</option>'; // Clear existing options

            const cityCabStands = cabStands[selectedCinemaCity];
            if (cityCabStands) {
                cityCabStands.forEach(stand => {
                    const option = document.createElement('option');
                    option.value = stand;
                    option.textContent = stand;
                    taxicabStandSelect.appendChild(option);
                });
            } else {
                showMessageBox(`No specific cab stands defined for ${selectedCinemaCity}. Please select 'Home' pickup or choose another city's cinema.`, "fas fa-info-circle blue-icon");
            }
        }


        // --- Header Search and Account Dropdown Functions (from tv_shows.js) ---
        function getUniqueValues(key) {
            const values = allShows.map(show => show[key]).flat();
            return [...new Set(values)].filter(Boolean).sort();
        }

        function showPrimarySuggestions() {
            const suggestionsBox = document.getElementById("suggestionsBox");
            if (!suggestionsBox) return;
            suggestionsBox.innerHTML = "";
            const primaryFilters = [
                { display: "Search by Category", type: "categories" },
                { display: "Search by Language", type: "languages" },
                { display: "Search by Genre", type: "genre" },
                { display: "Search by Release Year", type: "releaseDate" } // Will extract year later
            ];
            primaryFilters.forEach((filter, index) => {
                const div = document.createElement("div");
                div.textContent = filter.display;
                div.dataset.type = filter.type;
                div.dataset.index = index;
                if (index === selectedIndex) div.classList.add("selected");
                suggestionsBox.appendChild(div);
            });
            suggestionsBox.classList.add("active");
        }

        function renderScopedValueSuggestions(val) {
            const suggestionsBox = document.getElementById("suggestionsBox");
            if (!suggestionsBox) return;
            suggestionsBox.innerHTML = "";

            let uniqueValues = [];
            if (searchScope === "releaseDate") { // Corrected from "release year"
                uniqueValues = [...new Set(allShows.map(show => show.releaseDate.match(/\d{4}/)?.[0]).filter(Boolean))].sort();
            } else {
                uniqueValues = getUniqueValues(searchScope.replace(/\s/g, ''));
            }

            const filteredValues = uniqueValues.filter(value =>
                value.toLowerCase().includes(val.toLowerCase())
            );

            if (filteredValues.length > 0) {
                filteredValues.forEach((value, index) => {
                    const div = document.createElement("div");
                    div.textContent = value;
                    div.dataset.type = `${searchScope}:${value}`; // e.g., "category:Hollywood"
                    div.dataset.index = index;
                    if (index === selectedIndex) div.classList.add("selected");
                    suggestionsBox.appendChild(div);
                });
                suggestionsBox.classList.add("active");
            } else {
                suggestionsBox.classList.remove("active");
            }
        }

        function renderShowTitleSuggestions(val, currentScope = null) {
            const suggestionsBox = document.getElementById("suggestionsBox");
            if (!suggestionsBox) return;
            suggestionsBox.innerHTML = "";

            let filteredShows = allShows;
            if (currentScope && currentScope.includes(':')) {
                const [type, value] = currentScope.split(':');
                filteredShows = allShows.filter(show => {
                    // Handle categories/languages/genre which are arrays vs. releaseDate which is a string
                    if (Array.isArray(show[type])) {
                        return show[type].includes(value);
                    }
                    if (type === 'releaseDate') {
                        return show.releaseDate.includes(value); // Check if year is in date string
                    }
                    return String(show[type]) === value;
                });
            }

            const matchedShows = filteredShows.filter(show =>
                show.title.toLowerCase().includes(val.toLowerCase())
            );

            if (matchedShows.length > 0) {
                matchedShows.forEach((show, index) => {
                    const div = document.createElement("div");
                    div.textContent = show.title;
                    div.dataset.type = "show";
                    div.dataset.title = show.title;
                    div.dataset.index = index;
                    if (index === selectedIndex) div.classList.add("selected");
                    suggestionsBox.appendChild(div);
                });
                suggestionsBox.classList.add("active");
            } else {
                suggestionsBox.classList.remove("active");
            }
        }

        function updateAccountDropdown() {
            const accountDropdown = document.getElementById("accountDropdown");
            if (!accountDropdown) return;
            accountDropdown.innerHTML = ""; // Clear existing content

            if (userLoggedIn) {
                // Logged in menu
                const profileLink = document.createElement("a");
                profileLink.href = "#"; // Link to user profile page
                profileLink.innerHTML = `<i class="fas fa-user-circle"></i> View Profile (${currentUsername})`;
                accountDropdown.appendChild(profileLink);

                const playlistLink = document.createElement("a");
                playlistLink.href = "#"; // Link to playlist page
                playlistLink.innerHTML = `<i class="fas fa-list-ul"></i> Playlist`;
                accountDropdown.appendChild(playlistLink);

                const favoriteLink = document.createElement("a");
                favoriteLink.href = "#"; // Link to favorite page
                favoriteLink.innerHTML = `<i class="fas fa-heart"></i> Favorite`;
                accountDropdown.appendChild(favoriteLink);

                const settingsLink = document.createElement("a");
                settingsLink.href = "#"; // Link to settings page
                settingsLink.innerHTML = `<i class="fas fa-cog"></i> Settings`;
                settingsLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    // Redirect to the new settings preview page
                    window.location.href = 'cinewatch_settings_preview.html';
                });
                accountDropdown.appendChild(settingsLink);

                const logoutLink = document.createElement("a");
                logoutLink.href = "#"; // For logout functionality
                logoutLink.classList.add("logout-item");
                logoutLink.innerHTML = `<i class="fas fa-sign-out-alt"></i> Logout`;
                logoutLink.addEventListener("click", (e) => {
                    e.preventDefault();
                    userLoggedIn = false; // Simulate logout
                    updateAccountDropdown(); // Update dropdown immediately
                    showMessageBox("You have been logged out.", "fas fa-check-circle green-icon");
                    accountDropdown.classList.remove("visible"); // Hide dropdown after logout
                });
                accountDropdown.appendChild(logoutLink);
            } else {
                // Not logged in menu
                const loginLink = document.createElement("a");
                loginLink.href = "login.html"; // Link to login page
                loginLink.innerHTML = `<i class="fas fa-sign-in-alt"></i> Login`;
                accountDropdown.appendChild(loginLink);

                const signupLink = document.createElement("a");
                signupLink.href = "signup.html"; // Link to signup page
                signupLink.innerHTML = `<i class="fas fa-user-plus"></i> Sign Up`;
                accountDropdown.appendChild(signupLink);

                const playlistLink = document.createElement("a");
                playlistLink.href = "#";
                playlistLink.classList.add("disabled-link"); // Apply disabled styling
                playlistLink.innerHTML = `<i class="fas fa-list-ul"></i> Playlist`;
                playlistLink.addEventListener("click", (e) => {
                    e.preventDefault();
                    showMessageBox("Please Log in to view your Favourites.", "fas fa-info-circle blue-icon");
                });
                accountDropdown.appendChild(playlistLink);

                const favoriteLink = document.createElement("a");
                favoriteLink.href = "#";
                favoriteLink.classList.add("disabled-link"); // Apply disabled styling
                favoriteLink.innerHTML = `<i class="fas fa-heart"></i> Favorite`;
                favoriteLink.addEventListener("click", (e) => {
                    e.preventDefault();
                    showMessageBox("Please Log in to view your playlist.", "fas fa-info-circle blue-icon"); // Same message as playlist
                });
                accountDropdown.appendChild(favoriteLink);
            }
        }

        // --- Main execution logic for consolidated scripts ---
        document.addEventListener('DOMContentLoaded', () => {
            // Last Modified Date
            const lastModifiedSpan = document.getElementById('last-modified');
            if (lastModifiedSpan) {
                lastModifiedSpan.textContent = new Date(document.lastModified).toLocaleDateString();
            } else {
                console.warn("Last Modified span not found.");
            }

            // Dark Mode Toggle
            const darkModeToggle = document.getElementById('darkModeToggle');
            const body = document.body;
            const savedTheme = localStorage.getItem('theme');

            if (savedTheme === 'dark') {
                body.classList.add('dark-mode');
            } else {
                body.classList.remove('dark-mode');
            }

            if (darkModeToggle) {
                darkModeToggle.addEventListener('click', () => {
                    body.classList.toggle('dark-mode');
                    if (body.classList.contains('dark-mode')) {
                        localStorage.setItem('theme', 'dark');
                    } else {
                        localStorage.setItem('theme', 'light');
                    }
                });
            } else {
                console.warn("Dark mode toggle element not found. Dark mode functionality skipped.");
            }

            // Header Action Button Logic
            const addIcon = document.getElementById("addIcon");
            const accountIcon = document.getElementById("accountIcon");
            const accountDropdown = document.getElementById("accountDropdown");
            const searchIcon = document.getElementById("searchIcon");
            const searchSubheader = document.getElementById("searchSubheader");
            const searchInput = document.getElementById("searchInput");
            const clearSearch = document.getElementById("clearSearch");
            const suggestionsBox = document.getElementById("suggestionsBox");

            // Populate initial account dropdown state
            updateAccountDropdown();

            // Add Show Icon click handler
            if (addIcon) {
                addIcon.addEventListener('click', (event) => {
                    event.preventDefault();
                    if (userLoggedIn) {
                        showMessageBox("Add to Watchlist functionality is coming soon!", "fas fa-info-circle blue-icon");
                    } else {
                        showMessageBox("You must be logged in to add shows!", "fas fa-exclamation-triangle red-icon");
                    }
                });
            }

            // Account Icon click handler
            if (accountIcon) {
                accountIcon.addEventListener('click', (event) => {
                    event.preventDefault();
                    accountDropdown.classList.toggle("visible");
                });
            }

            // Search Icon/Subheader Logic
            if (searchIcon && searchSubheader && searchInput && suggestionsBox) {
                searchIcon.addEventListener('click', (event) => {
                    event.preventDefault();
                    searchSubheader.classList.toggle("hidden");
                    if (!searchSubheader.classList.contains("hidden")) {
                        searchInput.focus();
                        showPrimarySuggestions();
                    } else {
                        suggestionsBox.classList.remove("active");
                        searchInput.value = "";
                        searchScope = null; // Reset search scope
                    }
                });

                clearSearch.addEventListener("click", () => {
                    searchInput.value = "";
                    searchScope = null;
                    showPrimarySuggestions();
                    searchInput.focus();
                });

                searchInput.addEventListener("focus", () => {
                    if (searchInput.value.trim() === "" && !searchScope) {
                        showPrimarySuggestions();
                    } else if (searchScope && !searchScope.includes(':')) {
                        renderScopedValueSuggestions(searchInput.value.trim());
                    } else if (searchScope && searchScope.includes(':')) {
                        renderShowTitleSuggestions(searchInput.value.trim(), searchScope);
                    }
                });

                searchInput.addEventListener("blur", (e) => {
                    setTimeout(() => {
                        if (!suggestionsBox.contains(document.activeElement)) {
                            suggestionsBox.classList.remove("active");
                        }
                    }, 100);
                });

                suggestionsBox.addEventListener("click", (event) => {
                    const target = event.target;
                    if (target.closest('.suggestions-box div')) {
                        const type = target.dataset.type;
                        if (type && type.includes(':')) {
                            searchScope = type;
                            searchInput.value = `${type.split(':')[0]}: ${type.split(':')[1]} `;
                            renderShowTitleSuggestions("", searchScope);
                            searchInput.focus();
                        } else if (type && type !== "show") {
                            searchScope = type;
                            searchInput.value = `${target.textContent.replace('Search by ', '').toLowerCase().replace(' ', '')}: `; // Set input like "category: "
                            renderScopedValueSuggestions("");
                            searchInput.focus();
                        } else if (type === "show") {
                            const title = target.dataset.title;
                            window.location.href = `details.html?title=${title}`;
                        }
                        selectedIndex = -1;
                    }
                });

                searchInput.addEventListener("input", () => {
                    selectedIndex = -1;
                    const val = searchInput.value.trim();

                    if (!searchScope) {
                        if (val === "") {
                            showPrimarySuggestions();
                        } else {
                            renderShowTitleSuggestions(val);
                        }
                    } else {
                        if (searchScope.includes(':')) {
                            renderShowTitleSuggestions(val, searchScope);
                        } else {
                            renderScopedValueSuggestions(val);
                        }
                    }
                });

                document.addEventListener("click", e => {
                    const isClickInsideSearchIcon = searchIcon && searchIcon.contains(e.target);
                    const isClickInsideSearchSubheader = searchSubheader && searchSubheader.contains(e.target);
                    const isClickInsideAccountIcon = accountIcon && accountIcon.contains(e.target);
                    const isClickInsideAccountDropdown = accountDropdown && accountDropdown.contains(e.target);

                    if (!searchSubheader.classList.contains("hidden") && !isClickInsideSearchIcon && !isClickInsideSearchSubheader) {
                        searchSubheader.classList.add("hidden");
                        suggestionsBox.classList.remove("active");
                        searchInput.value = "";
                        searchScope = null;
                    }

                    if (accountDropdown && accountDropdown.classList.contains("visible") && !isClickInsideAccountIcon && !isClickInsideAccountDropdown) {
                        accountDropdown.classList.remove("visible");
                    }
                });
            } else {
                console.warn("Search elements not found. Search functionality skipped.");
            }

            // --- Buy Ticket Page Specific Logic ---

            const urlParams = new URLSearchParams(window.location.search);
            const movieTitleFromUrl = urlParams.get('title');
            const posterFilenameFromUrl = urlParams.get('poster');
            const backdropFilenameFromUrl = urlParams.get('backdrop');
            const cinemaNameFromUrl = urlParams.get('cinema');

            const movieDetails = allShows.find(show => show.title === movieTitleFromUrl);
            const cinemaDetails = cinemaData.find(cinema => cinema.name === cinemaNameFromUrl);


            if (movieDetails) {
                document.getElementById('hero-movie-title').textContent = movieDetails.title;
                document.getElementById('buyTicketHero').style.backgroundImage = `url('images/backdrops/${backdropFilenameFromUrl}')`;
                document.getElementById('movie-poster').src = `images/posters/${posterFilenameFromUrl}`;
                
                document.getElementById('buyTicketHero').onerror = function() {
                    this.style.backgroundImage = `url('https://placehold.co/900x300/333/fff?text=No+Backdrop')`;
                };
                document.getElementById('movie-poster').onerror = function() {
                    this.src = 'https://placehold.co/250x350/333/fff?text=No+Poster';
                };

                document.getElementById('movie-title-display').textContent = movieDetails.title;
                document.getElementById('movie-genre').textContent = movieDetails.genre;
                document.getElementById('movie-imdb').textContent = movieDetails.imdb;
                document.getElementById('movie-release-date').textContent = movieDetails.releaseDate;
                document.getElementById('movie-creators').textContent = movieDetails.creators;
                document.getElementById('movie-cast').textContent = movieDetails.cast;
                document.getElementById('movie-synopsis').textContent = movieDetails.synopsis;

                selectedMovieTitle = movieDetails.title;
                selectedCinemaName = cinemaNameFromUrl || "Unknown Cinema";
                selectedCinemaCity = cinemaDetails ? cinemaDetails.city : "Unknown"; // Set the city

                populateCabStands(); // Populate cab stands based on the cinema city
            } else {
                document.getElementById('hero-movie-title').textContent = "Movie Not Found";
                showMessageBox("Movie details not found. Please select a movie from the Cinema Guide page.", "fas fa-exclamation-triangle red-icon");
            }

            // Navigation buttons logic
            document.querySelectorAll('.proceed-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const targetStep = parseInt(button.dataset.targetStep);
                    if (isNaN(targetStep)) { // Check if targetStep is not a number (e.g., for final Pay Now)
                        return;
                    }

                    // Validation before proceeding
                    if (currentStep === 2) { // Seat Selection
                        if (selectedSeats.length === 0) {
                            showMessageBox("Please select at least one seat to proceed.", "fas fa-exclamation-triangle red-icon");
                            event.stopPropagation();
                            return;
                        }
                    }
                    // Step 3 (Snacks) has no mandatory validation, as snacks are optional

                    navigateToStep(targetStep);
                });
            });

            document.querySelectorAll('.back-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const targetStep = parseInt(button.dataset.targetStep);
                    if (targetStep) {
                        navigateToStep(targetStep);
                    }
                });
            });

            // Cab service logic
            const cabYesRadio = document.getElementById('cab-yes');
            const cabNoRadio = document.getElementById('cab-no');
            const cabDetailsDiv = document.getElementById('cab-details');
            const pickupHomeRadio = document.getElementById('pickup-home');
            const pickupTaxicabRadio = document.getElementById('pickup-taxicab');
            const homeAddressGroup = document.getElementById('home-address-group');
            const taxicabStandGroup = document.getElementById('taxicab-stand-group');
            const homeAddressInput = document.getElementById('home-address');
            const taxicabStandSelect = document.getElementById('taxicab-stand');
            const cabProviderSelect = document.getElementById('cab-provider');

            cabYesRadio.addEventListener('change', () => {
                cabServiceEnabled = true;
                cabDetailsDiv.classList.remove('hidden');
                updateCurrentTotalAmount();
            });
            cabNoRadio.addEventListener('change', () => {
                cabServiceEnabled = false;
                cabDetailsDiv.classList.add('hidden');
                selectedPickupType = ''; // Reset pickup type
                homeAddressGroup.classList.add('hidden');
                taxicabStandGroup.classList.add('hidden');
                homeAddressInput.value = ''; // Clear input
                taxicabStandSelect.value = ''; // Reset select
                cabProviderSelect.value = ''; // Reset provider
                updateCurrentTotalAmount();
            });

            pickupHomeRadio.addEventListener('change', () => {
                selectedPickupType = 'home';
                homeAddressGroup.classList.remove('hidden');
                taxicabStandGroup.classList.add('hidden');
                taxicabStandSelect.value = ''; // Clear taxicab selection
                homeAddressInput.disabled = false; // Enable home address
                taxicabStandSelect.disabled = true; // Disable taxicab stand
                updateCurrentTotalAmount();
            });
            pickupTaxicabRadio.addEventListener('change', () => {
                selectedPickupType = 'taxicab';
                taxicabStandGroup.classList.remove('hidden');
                homeAddressGroup.classList.add('hidden');
                homeAddressInput.value = ''; // Clear home address
                homeAddressInput.disabled = true; // Disable home address
                taxicabStandSelect.disabled = false; // Enable taxicab stand
                populateCabStands(); // Repopulate stands based on city
                updateCurrentTotalAmount();
            });

            cabProviderSelect.addEventListener('change', (event) => {
                selectedCabProvider = event.target.value;
                updateCurrentTotalAmount();
            });

            // Validation for "Proceed to Summary" button from Cab Service (Step 4)
            document.getElementById('proceed-to-summary-btn').addEventListener('click', (event) => {
                if (cabServiceEnabled) {
                    if (selectedPickupType === '') {
                        showMessageBox("Please select a pickup type (Home or Taxicab Stand) to proceed with cab service.", "fas fa-exclamation-triangle red-icon");
                        event.stopPropagation();
                        return;
                    }
                    if (selectedPickupType === 'home' && homeAddressInput.value.trim() === '') {
                        showMessageBox("Please enter your home address for cab service.", "fas fa-exclamation-triangle red-icon");
                        event.stopPropagation();
                        return;
                    }
                    if (selectedPickupType === 'taxicab' && taxicabStandSelect.value === '') {
                        showMessageBox("Please select a taxicab stand for cab service.", "fas fa-exclamation-triangle red-icon");
                        event.stopPropagation();
                        return;
                    }
                    if (selectedPickupType === 'taxicab') {
                        // Get the selected cab stand and its city (from the stand name itself or associated data)
                        const selectedStand = taxicabStandSelect.value;
                        let standCity = 'Unknown';
                        // Iterate through cabStands to find the city for the selected stand
                        for (const city in cabStands) {
                            if (cabStands[city].includes(selectedStand)) {
                                standCity = city;
                                break;
                            }
                        }
                        
                        if (standCity !== selectedCinemaCity && selectedCinemaCity !== "Unknown") {
                            showMessageBox(`The selected cab stand (${selectedStand}) is in ${standCity}, but your cinema is in ${selectedCinemaCity}. Please select a cab stand in ${selectedCinemaCity}.`, "fas fa-exclamation-triangle red-icon");
                            event.stopPropagation();
                            return;
                        }
                    }
                    if (cabProviderSelect.value === '') {
                         showMessageBox("Please select a cab provider to proceed with cab service.", "fas fa-exclamation-triangle red-icon");
                         event.stopPropagation();
                         return;
                    }
                }
                navigateToStep(5);
            });

            // Payment method selection logic
            document.querySelectorAll('.payment-method').forEach(methodDiv => {
                methodDiv.addEventListener('click', () => {
                    document.querySelectorAll('.payment-method').forEach(div => div.classList.remove('selected'));
                    methodDiv.classList.add('selected');
                    const radioButton = methodDiv.querySelector('input[type="radio"]');
                    if (radioButton) {
                        radioButton.checked = true;
                        selectedPaymentMethod = radioButton.value;
                    }
                });
            });

            // Final Pay Now button handler on the payment method step (Step 6)
            document.getElementById('final-pay-now-btn').addEventListener('click', () => {
                if (!selectedPaymentMethod) {
                    showMessageBox("Please select a payment method to proceed.", "fas fa-exclamation-triangle red-icon");
                    return;
                }

                if (totalAmount <= 0) {
                    showMessageBox("Cannot process payment. Total amount must be greater than zero. Please select seats or snacks.", "fas fa-exclamation-triangle red-icon");
                    return;
                }

                const selectedCinema = cinemaData.find(cinema => cinema.name === selectedCinemaName) || { welcomeMessage: "Thank you for your purchase! We eagerly await your visit!" };

                showMessageBox(`Payment successful! ${selectedCinema.welcomeMessage} Total paid: Ksh ${totalAmount.toFixed(2)}`, "fas fa-check-circle green-icon");
            });


            // Initial load: Go to the first step and render elements
            navigateToStep(1);
            renderSeats(8, 10); // Example: 8 rows, 10 columns
            renderSnacks();
            updateCurrentTotalAmount(); // Initial price update

            // JavaScript to update the "Last Modified" date in the footer
            document.getElementById('last-modified').textContent = document.lastModified;
        });
    </script>
</body>
</html>
